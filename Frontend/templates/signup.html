<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - VitalGaze</title>
    <link rel="stylesheet" href="../static/styles.css">
</head>

<body>
    <div class="min-h-screen">
        <!-- Header -->
        <header class="header">
            <nav class="container">
                <div class="logo">
                    <h1>VitalGaze</h1>
                </div>

                <div class="nav-links" id="navLinks">
                    <a href="{{ url_for('index')}}">Home</a>
                    <a href="{{ url_for('project')}}">Project</a>
                    <a href="{{ url_for('docs')}}">Docs</a>
                    <a href="{{ url_for('about')}}">About Us</a>
                    <a href="https://github.com" class="github-icon" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path
                                d="M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4" />
                            <path d="M9 18c-4.51 2-5-2-7-2" />
                        </svg>
                    </a>
                    <a href="{{ url_for('login')}}">Log In</a>
                </div>

                <button class="menu-toggle" onclick="toggleMenu()" aria-label="Toggle menu">
                    <svg xmlns="" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="4" x2="20" y1="12" y2="12" />
                        <line x1="4" x2="20" y1="6" y2="6" />
                        <line x1="4" x2="20" y1="18" y2="18" />
                    </svg>
                </button>
            </nav>
        </header>

        <!-- Main Content -->
        <main class="auth-page">
            <div class="container">
                <div class="auth-card">
                    <h2>Create Account</h2>
                    <p class="auth-subtitle">Get started with VitalGaze</p>

                    <form class="auth-form">
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" placeholder="Enter your email" required>
                        </div>

                        <div class="form-group">
                            <label for="password">Password</label>
                            <input type="password" id="password" placeholder="Create a password" required>
                        </div>

                        <div class="form-group">
                            <label for="confirm-password">Confirm Password</label>
                            <input type="password" id="confirm-password" placeholder="Confirm your password" required>
                        </div>

                        <div class="form-options">
                            <label class="remember-me">
                                <input type="checkbox" required>
                                <span>I agree to the <a href="/terms">Terms of Service</a> and <a
                                        href="/privacy">Privacy Policy</a></span>
                            </label>
                        </div>

                        <button type="submit" class="auth-button">Create Account</button>

                        <div class="auth-divider">
                            <span>or sign up with</span>
                        </div>

                        <button type="button" class="google-auth">
                            <svg xmlns="" width="20" height="20" viewBox="0 0 48 48">
                                <path fill="#FFC107"
                                    d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z" />
                                <path fill="#FF3D00"
                                    d="m6.306 14.691 6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z" />
                                <path fill="#4CAF50"
                                    d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z" />
                                <path fill="#1976D2"
                                    d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.571l.003-.002 6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917z" />
                            </svg>
                            Sign up with Google
                        </button>

                        <p class="auth-footer">
                            Already have an account? <a href="{{ url_for('login')}}">Sign in</a>
                        </p>
                    </form>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-brand">
                    <h2>VitalGaze</h2>
                </div>

                <div class="footer-links">
                    <a href="/terms">Terms and Service</a>
                    <a href="/privacy">Privacy</a>
                    <a href="/security">Security</a>
                    <a href="/about">About</a>
                </div>

                <div class="copyright">
                    © 2024 VitalGaze All rights reserved.
                </div>
            </div>
        </footer>
    </div>

    <script src="../static/script.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, updateProfile } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-auth.js";
        import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDmG1ldZE2aieir_s0c1OhsBWL4b6UJXds",
            authDomain: "vitalgaze-7084f.firebaseapp.com",
            projectId: "vitalgaze-7084f",
            storageBucket: "vitalgaze-7084f.appspot.com",
            messagingSenderId: "282183145389",
            appId: "1:282183145389:web:7ef2c29138e0cd21c2b324"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();
        const db = getFirestore(app); // Initialize Firestore

        // Signup with Email and Password
        document.querySelector(".auth-form").addEventListener("submit", async (event) => {
            event.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const username = prompt("Enter your name:");
            const confirmPassword = document.getElementById("confirm-password").value;

            if (password !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Store username in Firestore
                await setDoc(doc(db, "users", user.uid), { name: username, email: email });

                // ✅ Force Firebase to reload user data before redirecting
                await user.reload();
                console.log("User data updated in Firebase.");

                alert("Account created successfully!");
                window.location.href = "{{ url_for('index') }}"; // Redirect after storing the data
            } catch (error) {
                console.error("Signup Error:", error);
                alert(error.message);
            }
        });

        // Google Signup
        document.querySelector(".google-auth").addEventListener("click", () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    alert("Signed up with Google!");
                    console.log("User:", result.user);
                    window.location.href = "{{ url_for('index') }}"; // Redirect after Google signup
                })
                .catch((error) => {
                    alert(error.message);
                    console.error(error);
                });
        });

    </script>
</body>

</html>